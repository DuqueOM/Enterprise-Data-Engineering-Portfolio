---
# Secrets Template for MLOps deployment
# ⚠️  SECURITY NOTE: This is a TEMPLATE with placeholder values
# ⚠️  DO NOT commit actual secrets to git
# 
# Usage:
#   1. Copy this file: cp secrets.template.yaml secrets.yaml
#   2. Replace all REPLACE_WITH_* values with actual credentials
#   3. Apply: kubectl apply -f secrets.yaml
#   4. Verify secrets.yaml is in .gitignore
#
# Production Best Practices:
#   - Use external secret management: Vault, AWS Secrets Manager, GCP Secret Manager
#   - Use Sealed Secrets or External Secrets Operator for GitOps
#   - Rotate secrets regularly
#   - Use RBAC to restrict secret access

apiVersion: v1
kind: Secret
metadata:
  name: mlops-secrets
  namespace: mlops
  labels:
    app: mlops-deployment
    component: secrets
type: Opaque
stringData:
  # Experiment Tracking
  WANDB_API_KEY: "REPLACE_WITH_WANDB_KEY"
  MLFLOW_TRACKING_USERNAME: "admin"
  MLFLOW_TRACKING_PASSWORD: "REPLACE_WITH_MLFLOW_PASSWORD"
  
  # Notifications
  SLACK_WEBHOOK_URL: "https://hooks.slack.com/services/REPLACE/WITH/ACTUAL"
  GITHUB_TOKEN: "ghp_REPLACE_WITH_ACTUAL_TOKEN"
  
  # Database (PostgreSQL)
  DB_HOST: "postgres-service.mlops.svc.cluster.local"
  DB_PORT: "5432"
  DB_NAME: "mlops"
  DB_USER: "mlops_user"
  DB_PASSWORD: "REPLACE_WITH_DB_PASSWORD"
  DATABASE_URL: "postgresql://mlops_user:REPLACE_WITH_DB_PASSWORD@postgres-service.mlops.svc.cluster.local:5432/mlops"
  
  # Cache (Redis)
  REDIS_HOST: "redis-service.mlops.svc.cluster.local"
  REDIS_PORT: "6379"
  REDIS_PASSWORD: "REPLACE_WITH_REDIS_PASSWORD"
  REDIS_URL: "redis://:REPLACE_WITH_REDIS_PASSWORD@redis-service.mlops.svc.cluster.local:6379/0"
  
  # Cloud Provider - AWS
  AWS_ACCESS_KEY_ID: "AKIAIOSFODNN7EXAMPLE"
  AWS_SECRET_ACCESS_KEY: "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
  AWS_DEFAULT_REGION: "us-east-1"
  AWS_S3_BUCKET: "mlops-models-bucket"
  
  # Cloud Provider - GCP
  GCP_PROJECT_ID: "mlops-project-12345"
  GCP_SERVICE_ACCOUNT_KEY: |
    {
      "type": "service_account",
      "project_id": "mlops-project",
      "private_key_id": "REPLACE_WITH_KEY_ID",
      "private_key": "-----BEGIN PRIVATE KEY-----\nREPLACE_WITH_PRIVATE_KEY\n-----END PRIVATE KEY-----\n",
      "client_email": "mlops@mlops-project.iam.gserviceaccount.com"
    }
  
  # API Keys
  API_SECRET_KEY: "REPLACE_WITH_RANDOM_SECRET_KEY_MIN_32_CHARS"
  JWT_SECRET_KEY: "REPLACE_WITH_JWT_SECRET_KEY"
  
  # Monitoring
  GRAFANA_API_KEY: "REPLACE_WITH_GRAFANA_KEY"

---
# TLS Certificate Secret
# For production, use cert-manager to automate certificate management
apiVersion: v1
kind: Secret
metadata:
  name: mlops-tls
  namespace: mlops
  labels:
    app: mlops-deployment
    component: tls
type: kubernetes.io/tls
stringData:
  # Self-signed certificate for testing
  # Generate with: openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  #   -keyout tls.key -out tls.crt -subj "/CN=mlops.example.com"
  tls.crt: |
    -----BEGIN CERTIFICATE-----
    REPLACE_WITH_ACTUAL_CERTIFICATE
    -----END CERTIFICATE-----
  tls.key: |
    -----BEGIN PRIVATE KEY-----
    REPLACE_WITH_ACTUAL_PRIVATE_KEY
    -----END PRIVATE KEY-----

---
# Docker Registry Secret
# For pulling images from private registries (GitHub Container Registry, Docker Hub, etc.)
apiVersion: v1
kind: Secret
metadata:
  name: ghcr-secret
  namespace: mlops
  labels:
    app: mlops-deployment
    component: registry
type: kubernetes.io/dockerconfigjson
stringData:
  .dockerconfigjson: |
    {
      "auths": {
        "ghcr.io": {
          "username": "YOUR_GITHUB_USERNAME",
          "password": "YOUR_GITHUB_TOKEN",
          "email": "your.email@example.com",
          "auth": "BASE64_ENCODED_USERNAME:TOKEN"
        }
      }
    }

---
# Alternative: Use External Secrets Operator
# Uncomment if using External Secrets with AWS Secrets Manager
# apiVersion: external-secrets.io/v1beta1
# kind: ExternalSecret
# metadata:
#   name: mlops-secrets
#   namespace: mlops
# spec:
#   refreshInterval: 1h
#   secretStoreRef:
#     name: aws-secretsmanager
#     kind: SecretStore
#   target:
#     name: mlops-secrets
#     creationPolicy: Owner
#   data:
#     - secretKey: WANDB_API_KEY
#       remoteRef:
#         key: mlops/wandb-api-key
#     - secretKey: DB_PASSWORD
#       remoteRef:
#         key: mlops/db-password
